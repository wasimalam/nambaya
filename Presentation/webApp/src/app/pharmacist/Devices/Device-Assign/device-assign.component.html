<div *ngIf="isPharmacist" class="main-heading">
  <h4 class="sample-title">
    <span (click)="goToPatients()" class="icon-previous"></span>&nbsp;
    <span *ngIf="caseObject">
      {{ caseObject.firstName + ' ' + this.caseObject.lastName }}
      <span class="separator"></span>
      <span class="patient-id">{{ caseObject.pharmacyPatientID }}</span>
    </span>
  </h4>
</div>
<app-loader [isLoading]="isLoading"></app-loader>
<div [class.main-bg]="isPharmacist">
  <app-patient-wizard *ngIf="isPharmacist" [caseObject]="caseObject" [parentData]="parentData"></app-patient-wizard>
  <div class="sample-wrapper">
    <section class="sample-content">
      <article class="sample-column">
        <form class="input-group-form" (ngSubmit)="assignDevice()" [formGroup]="deviceAssignForm">
          <div class="column-holder">
            <div class="columns add" *ngIf="isPharmacist && !caseFinalizedByPharmacist">
              <div class="col-lg-12 row">
                <div class="box box-wizard">
                  <button type="submit" translate class="btn-secandory next-button" igxButton="raised" igxRipple>
                    <span class="fas fa-save"></span> Save & Close
                  </button>
                </div>
              </div>
            </div>
            <div class="columns row">
              <div class="col-lg-3" style="padding-left: 0;">
                <span class="subheadin" translate>Basic</span>
                <p>{{ 'you_have' | translate }} {{ devices.length }} {{ 'available_devices' | translate }}</p>
              </div>
              <div class="col-lg-4">
                <div class="box" *ngIf="caseObject && (caseObject.statusID == 651 || caseObject.statusID == 653)">
                  <igx-combo
                    #withValueKey
                    name="device"
                    id="device"
                    formControlName="device"
                    [data]="devices"
                    [(ngModel)]="deviceSelected"
                    displayKey="serialNumber"
                    valueKey="id"
                    (onSelectionChange)="singleSelection($event)"
                    searchPlaceholder="{{ 'enter_device_serial' | translate }}"
                  >
                    <ng-template igxComboEmpty>
                      <span *ngIf="devices.length > 0" translate>device_not_found</span>
                      <span *ngIf="devices.length < 1" translate>list_is_empty</span>
                    </ng-template>
                  </igx-combo>
                  <small
                    [hidden]="deviceAssignForm.controls.device.valid || deviceAssignForm.controls.device.untouched"
                    class="text-danger"
                    translate
                  >
                    Device is required
                  </small>
                </div>
                <div class="box" *ngIf="caseObject && (caseObject.statusID == 652 || caseObject.statusID >= 654)">
                  <igx-input-group>
                    <label igxLabel translate for="assignedDevice"></label>
                    <input
                      igxInput
                      name="assignedDevice"
                      id="assignedDevice"
                      [disabled]="true"
                      type="text"
                      formControlName="assignedDevice"
                    />
                  </igx-input-group>
                </div>
                <div class="box">
                  <igx-input-group>
                    <label igxLabel for="measurementStart" translate>Measurement Start Date Time</label>
                    <input
                      [owlDateTime]="dt1"
                      igxInput
                      [owlDateTimeTrigger]="dt1"
                      [(ngModel)]="dateselected"
                      name="measurementStart"
                      id="measurementStart"
                      type="text"
                      required
                      [disabled]="caseObject && (caseObject.statusID == 652 || caseObject.statusID >= 654)"
                      formControlName="measurementStart"
                    />
                    <span [owlDateTimeTrigger]="dt1"><i class="fad fa-calendar"></i></span>
                    <owl-date-time #dt1></owl-date-time>
                  </igx-input-group>
                  <small
                    translate
                    [hidden]="
                      deviceAssignForm.controls.measurementStart.valid ||
                      deviceAssignForm.controls.measurementStart.untouched
                    "
                    class="text-danger"
                    >measurement_start_required
                  </small>
                </div>
                <a
                  translate
                  *ngIf="!caseFinalizedByPharmacist && caseObject && caseObject.statusID == 652"
                  href="javascript:void(0)"
                  class="edit custom-link"
                  (click)="openReassignDeviceDialog()"
                  ><span class="fas fa-user-clock"></span> {{ 'reassign_device' | translate }}</a
                >
              </div>
              <div class="col-lg-5">&nbsp;</div>
            </div>
          </div>
        </form>
      </article>
    </section>
  </div>
</div>
<igx-dialog
  #reassignConfirmDialog
  title="{{ 'Confirmation' | translate }}"
  leftButtonLabel="{{ 'Cancel' | translate }}"
  (onLeftButtonSelect)="reassignConfirmDialog.close()"
  rightButtonLabel="OK"
  (onRightButtonSelect)="unAssignDevice()"
  message="{{ 'sure_to_reassign' | translate }}"
>
</igx-dialog>
